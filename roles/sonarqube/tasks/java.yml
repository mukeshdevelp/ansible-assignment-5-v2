---


# Test internet connectivity before apt update
- name: Test internet connectivity
  command: ping -c 3 8.8.8.8
  register: ping_result
  ignore_errors: yes
  changed_when: false

- name: Display connectivity test result
  debug:
    msg: "Internet connectivity test: {{ 'PASSED' if ping_result.rc == 0 else 'FAILED - Check NAT Gateway' }}"
  when: ping_result.rc is defined

# update caches for ubuntu and debian based systems
- name: Update package cache on Debian/Ubuntu
  apt:
    update_cache: yes
  timeout: 300  # 5 minutes timeout
  retries: 3
  delay: 10
  when: ansible_facts['os_family'] == "Debian"
# update caches for redhat based systems
- name: Update package cache on RedHat/CentOS/RHEL
  yum:
    update_cache: yes
  when: ansible_facts['os_family'] == "RedHat"
  
# install java package based on os family independently
- name: Install Java
  package:
    name: "{{ java_pkg }}"
    state: present
  timeout: 600  # 10 minutes timeout for package installation
  retries: 3
  delay: 10

- name: Get Java version
  command: java -version
  register: java_version_output
  changed_when: false
  ignore_errors: true

- name: Show Java version
  debug:
    msg: |
      Java version on {{ inventory_hostname }}:
      {{ java_version_output.stderr_lines | default(java_version_output.stdout_lines) }}
