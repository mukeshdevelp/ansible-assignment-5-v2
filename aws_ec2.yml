---
plugin: amazon.aws.aws_ec2

regions:
  - us-east-1

filters:
  "tag:env": "sonarqube"

hostnames:
  - private-ip-address

compose:
  ansible_host: private_ip_address
  ansible_user: ubuntu
  ansible_ssh_private_key_file: "{{ lookup('env','WORKSPACE') | default('/var/lib/jenkins/workspace/aws-infra-pipeline') }}/.ssh/sonarqube-key.pem"
  ansible_ssh_common_args: "-o ControlMaster=no -o ControlPath=none -o ControlPersist=no -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ServerAliveInterval=3 -o ServerAliveCountMax=40 -o ConnectTimeout=60 -o BatchMode=yes -o TCPKeepAlive=yes -o Compression=no"
  ansible_ssh_timeout: 120

keyed_groups:
  - key: tags.env
    prefix: ""
    separator: "_"
  - key: tags.Name
    prefix: ""

strict: False

# Use your venv Python
vars:
  ansible_python_interpreter: "{{ lookup('env','VIRTUAL_ENV') + '/bin/python3' }}"
